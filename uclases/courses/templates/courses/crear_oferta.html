{% extends "base.html" %}

{% block content %}
<div class="max-w-3xl mx-auto bg-card p-8 rounded-xl shadow-md">
  <h1 class="text-2xl font-semibold mb-6">Nueva Oferta de Clase</h1>

  <form method="post">
    {% csrf_token %}

    <h2 class="text-lg font-medium mb-2">Informaci√≥n de la oferta</h2>
    {{ form.as_p }}

    <hr class="my-6">

    <h2 class="text-lg font-medium mb-2">Horarios ofertados</h2>

    {{ formset.management_form }}

    <div id="horarios-container">
      {% for hf in formset %}
        <div class="horario-form border border-border rounded-lg p-4 mb-4 bg-background/70">
          {{ hf.as_p }}
        </div>
      {% endfor %}
    </div>

    <button type="button" id="addHorario" class="mb-4 px-3 py-2 border rounded">+ Agregar horario</button>

    <!-- üëá OJO: NO uses |escapejs aqu√≠ -->
    <template id="empty-form-template">
      <div class="horario-form border border-border rounded-lg p-4 mb-4 bg-background/70">
        {{ formset.empty_form.as_p }}
      </div>
    </template>

    <button type="submit"
            class="bg-primary text-white px-4 py-2 rounded-md hover:opacity-90">
      Crear Oferta
    </button>
  </form>
</div>

<script>
  (function () {
    const prefix = "horarios"; // usa el mismo prefix que en la vista
    const totalInput = document.getElementById(`id_${prefix}-TOTAL_FORMS`);
    const container = document.getElementById("horarios-container");
    const tpl = document.getElementById("empty-form-template");
    const addBtn = document.getElementById("addHorario");

    addBtn.addEventListener("click", () => {
      const index = parseInt(totalInput.value, 10);

      // Toma el HTML del template y reemplaza __prefix__ por el √≠ndice nuevo
      const html = tpl.innerHTML.replace(/__prefix__/g, index);
      container.insertAdjacentHTML("beforeend", html);

      totalInput.value = index + 1;
    });
  })();
</script>
{% endblock %}